<form id="parameter-form">
  <label for="auth-token">Auth Token:</label>
  <input id="auth-token" name="auth-token" required>

  <label for="patient-identifier">Pseudonym:</label>
  <input id="patient-identifier" name="patient-identifier" required>

  <button type="submit">Submit</button>
  <a href="index.html">Home</a>
</form>

<div id="vaccination-container"></div>

<!-- Ensure the component script loads correctly -->
<script type="module" defer src="node_modules/@smals-belgium-shared/vitalink-webcomponents/VitalinkVaccinationTable/0.0.5/main.js"></script>

<script>
  const form = document.getElementById('parameter-form');
  const container = document.getElementById('vaccination-container');

  form.addEventListener('submit', async (event) => {
    event.preventDefault();

    const authToken = document.getElementById('auth-token').value.trim();
    const patientIdentifier = document.getElementById('patient-identifier').value.trim();

    // Wait until the custom element is ready
    await customElements.whenDefined('vitalink-vaccination-table');

    // Remove existing component
    const existingTable = container.querySelector('vitalink-vaccination-table');
    if (existingTable) existingTable.remove();

    // Create and configure a new component (try properties first)
    const table = document.createElement('vitalink-vaccination-table');
    table.server = 'https://apps-acpt.vitalink-services.be/vault/api/r4';
    table.authToken = authToken;
    table.patientIdentifier =
      'https://www.ehealth.fgov.be/standards/fhir/core/NamingSystem/ssin|urn:be:fgov:ehealth:pseudo:v1:' + patientIdentifier;
    table.patientSsin = '87051423939';
    table.patientFullName = 'Gwen Bleyen';
    table.language = 'nl';

    container.appendChild(table);
  });
</script>
